#mpc

Model Context Protocol（MCP）サーバーは、AIエージェントと外部ツール・データソースを安全に連携させるための標準プロトコルです。このガイドでは、**実際に使われている5つの主要な配置方法**を詳しく解説します。

## MCPサーバーの配置方法一覧

調査により、MCPサーバーは以下の**5つの主要な方法**で配置・使用されていることが確認されました：

### 1. **ローカル直接実行（最も一般的）** 📦

**概要：** npmやuvxコマンドでサーバーを直接実行する方法

**設定例（Claude Desktop）：**

```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/Users/username/Desktop"]
    },
    "github": {
      "command": "uvx",
      "args": ["mcp-server-github"],
      "env": {"GITHUB_PERSONAL_ACCESS_TOKEN": "ghp_xxxx"}
    }
  }
}
```

**メリット：**

- セットアップが最も簡単
- 起動が高速（レスポンス時間：10-50ms）
- デバッグしやすい
- 追加の環境構築不要

**デメリット：**

- 依存関係の競合が発生しやすい
- セキュリティ上のリスク
- 環境の違いで動作しない場合がある

**適用場面：** 開発・プロトタイピング、個人利用

---

### 2. **Dockerコンテナ実行（本番推奨）** 🐳

**概要：** サーバーをDockerコンテナ内で実行する方法

**設定例：**

```json
{
  "mcpServers": {
    "github": {
      "command": "docker",
      "args": [
        "run", "-i", "--rm",
        "-e", "GITHUB_PERSONAL_ACCESS_TOKEN=${GITHUB_TOKEN}",
        "ghcr.io/github/github-mcp-server"
      ]
    },
    "postgres": {
      "command": "docker",
      "args": ["run", "-i", "--rm", "mcp/postgres"],
      "env": {"DATABASE_URL": "postgresql://localhost/mydb"}
    }
  }
}
```

**メリット：**

- **環境の一貫性**が保たれる
- **セキュリティが高い**（コンテナによる分離）
- 依存関係の競合なし
- 配布・共有が簡単

**デメリット：**

- Dockerの知識が必要
- リソース消費が多い（50-200MB追加）
- 起動時間が長い（2-5秒）

**適用場面：** 本番環境、チーム開発、企業利用

---

### 3. **クラウドファンクション（サーバーレス）** ☁️

**概要：** AWS Lambda、Google Cloud Run、Cloudflare Workersなどでホスト

**設定例（リモートHTTP）：**

```json
{
  "mcpServers": {
    "company-api": {
      "type": "sse",
      "url": "https://api.company.com/mcp/sse",
      "headers": {
        "Authorization": "Bearer ${COMPANY_API_TOKEN}"
      }
    }
  }
}
```

**メリット：**

- **自動スケーリング**
- サーバー管理不要
- 従量課金（使った分だけ）
- グローバル配信

**デメリット：**

- コールドスタート（1-3秒の遅延）
- プラットフォーム依存
- 複雑な設定

**適用場面：** 大規模運用、スケーラブルなサービス

---

### 4. **NPMパッケージ配布** 📦

**概要：** パッケージとして公開し、npxで実行

**使用例：**

```bash
# グローバルインストール（推奨）
npm install -g @modelcontextprotocol/server-github

# 設定ファイル
{
  "mcpServers": {
    "github": {
      "command": "/usr/local/bin/mcp-server-github",
      "args": [],
      "env": {"GITHUB_PERSONAL_ACCESS_TOKEN": "token"}
    }
  }
}
```

**メリット：**

- 配布が簡単
- バージョン管理
- 依存関係の自動解決

**デメリット：**

- Windowsで動作問題が多い
- nvmとの競合
- セキュリティリスク

**適用場面：** オープンソースツール、簡単な配布

---

### 5. **MCP Toolkitによる管理** 🛠️

**概要：** Docker Desktop拡張機能による統合管理

**特徴：**

- GUI操作でMCPサーバーを選択・起動
- 認証情報の安全な管理
- 複数クライアント（Claude Desktop、Cursor）との一元接続
- Docker MCP Catalogからの簡単インストール

**メリット：**

- **技術知識不要**
- 設定ファイル編集なし
- セキュアな認証情報管理
- 複数サーバーの一元管理

**デメリット：**

- Docker Desktopが必要
- GUI環境必須
- 比較的新しいツール

**適用場面：** 非技術者、GUI操作を好むユーザー

---

## 設定場所とクライアント対応

### Claude Desktopの設定

**設定ファイル場所：**

- **macOS:** `~/Library/Application Support/Claude/claude_desktop_config.json`
- **Windows:** `%APPDATA%/Claude/claude_desktop_config.json`

### VS Code / Cursorの設定

**プロジェクト単位の設定：**

```json
// .vscode/mcp.json または .cursor/mcp.json
{
  "mcpServers": {
    "project-context": {
      "command": "node",
      "args": ["./mcp-server/index.js"],
      "env": {"PROJECT_ROOT": "${workspaceFolder}"}
    }
  }
}
```

---

## 用途別おすすめ配置方法

|用途|推奨方法|理由|
|---|---|---|
|**学習・実験**|ローカル直接実行|簡単、高速|
|**個人開発**|NPMパッケージ|手軽、バージョン管理|
|**チーム開発**|Docker|環境統一、安全性|
|**本番環境**|Docker + プロセス管理|安定性、監視|
|**大規模サービス**|クラウドファンクション|スケーラビリティ|
|**非技術者**|MCP Toolkit|GUI操作、簡単|

---

## よくある問題と解決方法

### 1. Windows環境での問題

**問題：** npxコマンドでパス解決エラー **解決策：**

- 絶対パスを使用
- グローバルインストールを利用
- WSLの使用を検討

### 2. 認証エラー

**問題：** API トークンの設定ミス **解決策：**

- 環境変数の正確な設定
- 権限の確認
- トークンの有効期限チェック

### 3. 依存関係の競合

**問題：** 複数のNode.jsバージョンによる競合 **解決策：**

- Dockerコンテナの使用
- 仮想環境の活用
- バージョン固定

---

## まとめ

MCPサーバーの配置方法は**用途に応じて使い分ける**ことが重要です：

1. **開発段階：** ローカル直接実行で素早くプロトタイピング
2. **チーム共有：** Dockerで環境を統一
3. **本番運用：** クラウドファンクションまたはDocker + 監視
4. **簡単利用：** MCP Toolkitで手軽に管理

**2025年のトレンド**では、Docker Toolkitによる統合管理とクラウドファンクションによるサーバーレス配置が主流になりつつあります。技術レベルと用途に応じて最適な方法を選択しましょう。